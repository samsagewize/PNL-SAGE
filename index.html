<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tradoor - Minimal Trading Journal</title>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0 0 90px 0;
      background: #1a0033;
      color: #e6e6ff;
      min-height: 100vh;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: #2d1b4d;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .logo { font-size: 1.8em; font-weight: bold; }
    #profilePic { width: 48px; height: 48px; border-radius: 50%; border: 3px solid #bb86fc; object-fit: cover; }
    .profile-name { font-weight: bold; margin-left: 10px; }
    h1 { text-align: center; color: #bb86fc; padding: 20px 0; margin: 0; font-size: 2em; }
    .page { padding: 20px; }
    .welcome { text-align: center; margin: 40px 0; }
    .welcome img { width: 100px; height: 100px; border-radius: 50%; border: 4px solid #bb86fc; object-fit: cover; }
    .welcome h2 { margin: 16px 0 8px; font-size: 1.8em; }
    .welcome p { opacity: 0.9; font-size: 1.1em; }
    /* Big PnL Button */
    .pnl-button {
      display: block;
      width: 90%;
      max-width: 400px;
      margin: 40px auto;
      padding: 24px;
      background: linear-gradient(135deg, #bb86fc, #9b59b6);
      color: #1a0033;
      font-size: 1.5em;
      font-weight: bold;
      text-align: center;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(187, 134, 252, 0.4);
    }
    .pnl-button:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(187, 134, 252, 0.6); }
    /* Popup Modal */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: center; }
    .modal.active { display: flex; }
    .modal-content {
      background: #2d1b4d;
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    }
    .close-modal { float: right; font-size: 2em; cursor: pointer; color: #bb86fc; }
    .modal h2 { color: #bb86fc; margin-top: 0; }
    .modal p { font-size: 1.2em; margin: 16px 0; }
    .big-number { font-size: 2.5em; font-weight: bold; color: #bb86fc; margin: 10px 0; }
    .positive { color: #00ff9d; }
    .negative { color: #ff3b5c; }
    /* Table section - collapsible for space */
    .section-title {
      text-align: center;
      margin: 40px 0 20px;
      font-size: 1.4em;
      color: #bb86fc;
    }
    .table-container { overflow-x: auto; margin: 20px 0; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    table { width: 100%; min-width: 800px; border-collapse: collapse; background: #2d1b4d; }
    th, td { padding: 14px 8px; text-align: center; border: 1px solid #4a2a7d; font-size: 0.95em; }
    th { background: #bb86fc; color: #1a0033; }
    tfoot input, tfoot select { padding: 12px; font-size: 1em; }
    button { padding: 12px 20px; background: #bb86fc; color: #1a0033; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; }
    .add-btn { width: 100%; padding: 16px; font-size: 1.2em; }
    .bottom-menu {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #2d1b4d;
      display: flex;
      justify-content: space-around;
      padding: 16px 0;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.6);
      z-index: 100;
    }
    .menu-btn { background: none; border: none; color: #bb86fc; font-size: 2em; cursor: pointer; flex: 1; }
    .menu-btn.active { color: #ffffff; }
    @media (max-width: 480px) {
      h1 { font-size: 1.8em; }
      .pnl-button { font-size: 1.3em; padding: 20px; }
      .modal-content { padding: 20px; }
      .big-number { font-size: 2em; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="logo">Tradoor</div>
    <div onclick="showPage('profile')" style="display:flex;align-items:center;cursor:pointer;">
      <img id="profilePic" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Trader" alt="Profile">
      <div class="profile-name" id="topProfileName">Trader</div>
    </div>
  </div>

  <h1>Tradoor</h1>

  <div class="page active" id="trades">
    <div class="welcome">
      <img id="dashboardProfilePic" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Trader" alt="Profile">
      <h2>Welcome, <span id="welcomeName">Trader</span></h2>
      <p>Track. Improve. Win.</p>
    </div>

    <!-- Big PnL Summary Button -->
    <button class="pnl-button" onclick="showPnLSummary()">View My PnL Summary</button>

    <!-- Trades Table (Collapsible feel with spacing) -->
    <div class="section-title">Your Trade History</div>
    <div class="table-container">
      <table id="tradesTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Pair</th>
            <th>Dir</th>
            <th>Entry</th>
            <th>Exit</th>
            <th>Size ($)</th>
            <th>Lvg</th>
            <th>Vol ($)</th>
            <th>Fees</th>
            <th>PnL ($)</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="tradesBody"></tbody>
        <tfoot>
          <tr>
            <td><input type="date" id="newDate"></td>
            <td><input type="text" id="newPair" placeholder="BTCUSDT"></td>
            <td><select id="newDirection"><option>Long</option><option>Short</option></select></td>
            <td><input type="number" step="0.01" id="newEntry"></td>
            <td><input type="number" step="0.01" id="newExit"></td>
            <td><input type="number" step="0.01" id="newSize" placeholder="100"></td>
            <td><input type="number" id="newLeverage" value="10"></td>
            <td></td>
            <td><input type="number" step="0.01" id="newFees" value="0"></td>
            <td></td>
            <td><button class="add-btn" onclick="addTrade()">Add Trade</button></td>
          </tr>
        </tfoot>
      </table>
    </div>
    <!-- Add more space at bottom -->
    <div style="height:100px;"></div>
  </div>

  <!-- PnL Summary Modal -->
  <div id="pnlModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closePnLSummary()">Ã—</span>
      <h2>Your PnL Summary</h2>
      <div class="big-number" id="modalTotalPnL">$0.00</div>
      <p>Total Trades: <strong id="modalTotalTrades">0</strong></p>
      <p>Win Rate: <strong id="modalWinRate">0%</strong></p>
      <p>Avg Win: <strong id="modalAvgWin">$0.00</strong> | Avg Loss: <strong id="modalAvgLoss">$0.00</strong></p>
      <p>Profit Factor: <strong id="modalProfitFactor">0.00</strong></p>
      <p>Current Balance: <strong id="modalBalance">$0.00</strong></p>
    </div>
  </div>

  <!-- Bottom Menu -->
  <div class="bottom-menu">
    <button class="menu-btn active">ðŸ“Š</button>
    <button class="menu-btn" onclick="showPage('profile')">ðŸ‘¤</button>
  </div>

  <script>
    // Same core functions as before (trades, profile, etc.) + new modal
    const { DateTime } = luxon;
    let trades = JSON.parse(localStorage.getItem('tradoorTrades')) || [];
    let profile = JSON.parse(localStorage.getItem('tradoorProfile')) || { name: 'Trader', startingBalance: 0, riskPercent: 1, profilePic: null };

    function generateAvatar(seed) { return `https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(seed || 'Trader')}`; }

    function updateAllProfilePics() {
      const src = profile.profilePic || generateAvatar(profile.name);
      document.getElementById('profilePic').src = src;
      document.getElementById('dashboardProfilePic').src = src;
      document.getElementById('topProfileName').textContent = profile.name;
      document.getElementById('welcomeName').textContent = profile.name;
    }

    function calculatePnL(trade) {
      if (!trade.entry) return 0;
      const change = trade.direction === 'Long' ? (trade.exit - trade.entry) / trade.entry : (trade.entry - trade.exit) / trade.entry;
      return (change * trade.size * trade.leverage) - trade.fees;
    }

    function addTrade() {
      const trade = {
        date: document.getElementById('newDate').value || DateTime.now().toFormat('yyyy-MM-dd'),
        pair: document.getElementById('newPair').value.trim() || 'UNKNOWN',
        direction: document.getElementById('newDirection').value,
        entry: parseFloat(document.getElementById('newEntry').value) || 0,
        exit: parseFloat(document.getElementById('newExit').value) || 0,
        size: parseFloat(document.getElementById('newSize').value) || 0,
        leverage: parseFloat(document.getElementById('newLeverage').value) || 1,
        fees: parseFloat(document.getElementById('newFees').value) || 0,
      };
      if (!trade.entry || !trade.exit || !trade.size) return alert("Fill Entry, Exit, Size");
      trade.volume = trade.size * trade.leverage;
      trade.pnl = calculatePnL(trade);
      trades.push(trade);
      localStorage.setItem('tradoorTrades', JSON.stringify(trades));
      renderTrades();
      clearAddForm();
    }

    function clearAddForm() {
      document.getElementById('newEntry').value = '';
      document.getElementById('newExit').value = '';
      document.getElementById('newSize').value = '';
      document.getElementById('newFees').value = '0';
      document.getElementById('newPair').value = '';
    }

    function renderTrades() {
      const tbody = document.getElementById('tradesBody');
      tbody.innerHTML = '';
      trades.sort((a, b) => b.date.localeCompare(a.date)).forEach((trade, i) => {
        const row = document.createElement('tr');
        row.className = trade.pnl > 0 ? 'highlight-win' : trade.pnl < 0 ? 'highlight-loss' : '';
        row.innerHTML = `
          <td>${trade.date}</td>
          <td>${trade.pair}</td>
          <td>${trade.direction.slice(0,1)}</td>
          <td>${trade.entry.toFixed(2)}</td>
          <td>${trade.exit.toFixed(2)}</td>
          <td>${trade.size.toFixed(2)}</td>
          <td>${trade.leverage}x</td>
          <td>${trade.volume.toFixed(2)}</td>
          <td>${trade.fees.toFixed(2)}</td>
          <td>${trade.pnl.toFixed(2)}</td>
          <td><button onclick="trades.splice(${i},1); localStorage.setItem('tradoorTrades', JSON.stringify(trades)); renderTrades();">Del</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function showPnLSummary() {
      const wins = trades.filter(t => t.pnl > 0);
      const losses = trades.filter(t => t.pnl < 0);
      const totalPnL = trades.reduce((s, t) => s + t.pnl, 0);
      const winRate = trades.length ? (wins.length / trades.length * 100).toFixed(1) : 0;
      const avgWin = wins.length ? (wins.reduce((s, t) => s + t.pnl, 0) / wins.length) : 0;
      const avgLoss = losses.length ? (losses.reduce((s, t) => s + t.pnl, 0) / losses.length) : 0;
      const profitFactor = avgLoss === 0 ? 'âˆž' : (avgWin / -avgLoss).toFixed(2);
      const balance = profile.startingBalance + totalPnL;

      document.getElementById('modalTotalPnL').textContent = totalPnL.toFixed(2);
      document.getElementById('modalTotalPnL').className = 'big-number ' + (totalPnL >= 0 ? 'positive' : 'negative');
      document.getElementById('modalTotalTrades').textContent = trades.length;
      document.getElementById('modalWinRate').textContent = winRate + '%';
      document.getElementById('modalAvgWin').textContent = '$' + avgWin.toFixed(2);
      document.getElementById('modalAvgLoss').textContent = '$' + avgLoss.toFixed(2);
      document.getElementById('modalProfitFactor').textContent = profitFactor;
      document.getElementById('modalBalance').textContent = '$' + balance.toFixed(2);

      document.getElementById('pnlModal').classList.add('active');
    }

    function closePnLSummary() {
      document.getElementById('pnlModal').classList.remove('active');
    }

    // Init
    document.getElementById('newDate').value = DateTime.now().toFormat('yyyy-MM-dd');
    updateAllProfilePics();
    renderTrades();
  </script>
</body>
</html>
